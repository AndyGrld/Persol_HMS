@model Persol_HMS.Models.ViewModels.LabsViewModel

<partial name="Navbar" />

@if (TempData.ContainsKey("L_ConfirmationMessage"))
{
    <div class="alert alert-success">
        @TempData["L_ConfirmationMessage"]
        <button type="button" style="position:absolute;right: 0" data-bs-dismiss="alert" class="btn-close" aria-label="Close"></button>
    </div>
}
@if (TempData.ContainsKey("L_WarningMessage"))
{
    <div class="alert alert-danger">
        @TempData["L_WarningMessage"]
        <button type="button" style="position:absolute;right: 0" data-bs-dismiss="alert" class="btn-close" aria-label="Close"></button>
    </div>
}

<div class="grid">
    <partial name="SidebarPartial" />
    <div class="right">
<h2 class="text-center">Lab for Patient: @ViewBag.Name</h2>
<form asp-controller="Staff" asp-action="PatientLab" autocomplete="off">
    <div class="container text-center">
	<div id="lab-fields">
        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <textarea asp-for="Labs[0].LabName" style="height: 200px" class="form-control" placeholder="Lab Name" name="Labs[0].LabName"></textarea>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <textarea asp-for="Labs[0].Result" style="height: 200px" class="form-control" placeholder="Lab Result" name="Labs[0].Result"></textarea>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <textarea asp-for="Labs[0].Notes" style="height: 200px" class="form-control" placeholder="Lab Notes" name="Labs[0].Notes"></textarea>
                </div>
            </div>
        </div>
	</div>
    <input asp-for="PatientNo" value="@Model.PatientNo" style="display:none" />
    </div>
    <div class="modal-footer">
        <button type="button" id="addMore"class="btn btn-success">Add More Labs</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
</form>
    </div>
</div>

@section scripts {
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            var index = 1;
            $('#addMore').click(function () {
                $('#lab-fields').append(`
                    <div class="row">
                        <div class="col">
                            <div class="mb-3">
                                <textarea asp-for="Labs[${index}].LabName" style="height: 200px" class="form-control" placeholder="Lab Name" name="Labs[${index}].LabName"></textarea>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <textarea asp-for="Labs[${index}].Result" style="height: 200px" class="form-control" placeholder="Lab Result" name="Labs[${index}].Result"></textarea>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <textarea asp-for="Labs[${index}].Notes" style="height: 200px" class="form-control" placeholder="Lab Notes" name="Labs[${index}].Notes"></textarea>
                            </div>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-danger remove-lab">Remove Lab</button>
                        </div>
                    </div>
                `);
                index++;
            });
        $('#lab-fields').on('click', '.remove-lab', function () {
            var removeIndex = $(this).closest('.row').index();
            $(this).closest('.row').remove();
            index--;
        });
    });
    </script>

}